<!DOCTYPE html>
<html lang="en">
<head>
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Noor">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="shortcut icon" href="/icons/favicon.ico">
  <!-- Google Analytics GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZZG5K1EVSV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "G-ZZG5K1EVSV", {page_title: 'Real Talk Bingo'});
  </script>
  <!-- Vercel Analytics -->
  <script defer src="/_vercel/insights/script.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ramadan Real Talk ‚Äî Noor</title>
  <meta name="description" content="How is Ramadan REALLY going for you? Tap what applies. Get your title. Share with friends.">
  <meta property="og:title" content="Ramadan Real Talk Bingo üòÖ ‚Äî Noor">
  <meta property="og:description" content="How is Ramadan REALLY going for you? Tap what applies. Get your title. Share with friends.">
  <meta property="og:image" content="https://noor-seven-lac.vercel.app/og-bingo.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://noor-seven-lac.vercel.app/bingo">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Ramadan Real Talk Bingo üòÖ ‚Äî Noor">
  <meta name="twitter:description" content="How is Ramadan REALLY going for you? Tap what applies. Get your title. Share with friends.">
  <meta name="twitter:image" content="https://noor-seven-lac.vercel.app/og-bingo.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&family=Tajawal:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0f;
      --bg2: #0f0f1a;
      --gold: #c9a84c;
      --gold-light: #e8c97a;
      --gold-dim: #7a6130;
      --cream: #f5efe0;
      --text: #e8dcc8;
      --text-dim: #8a7d6a;
      --checked: rgba(201,168,76,0.25);
      --checked-border: rgba(201,168,76,0.7);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Tajawal', sans-serif;
      min-height: 100vh;
      padding-bottom: 120px;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        radial-gradient(1px 1px at 15% 20%, rgba(201,168,76,0.5) 0%, transparent 100%),
        radial-gradient(1px 1px at 85% 10%, rgba(201,168,76,0.3) 0%, transparent 100%),
        radial-gradient(1px 1px at 40% 80%, rgba(201,168,76,0.4) 0%, transparent 100%),
        radial-gradient(1px 1px at 70% 60%, rgba(201,168,76,0.2) 0%, transparent 100%),
        radial-gradient(1.5px 1.5px at 90% 75%, rgba(201,168,76,0.4) 0%, transparent 100%);
      pointer-events: none;
      z-index: 0;
    }

    .page {
      position: relative;
      z-index: 1;
      max-width: 520px;
      margin: 0 auto;
      padding: 24px 16px;
    }

    .back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--text-dim);
      text-decoration: none;
      font-size: 13px;
      margin-bottom: 24px;
      transition: color 0.2s;
    }
    .back:hover { color: var(--gold); }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }

    .header-icon { font-size: 40px; margin-bottom: 8px; }

    .header h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 42px;
      font-weight: 400;
      color: var(--gold-light);
      line-height: 1.1;
    }

    .header p {
      font-size: 14px;
      color: var(--text-dim);
      margin-top: 8px;
      font-weight: 300;
    }

    .score-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(201,168,76,0.07);
      border: 1px solid rgba(201,168,76,0.15);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 20px;
    }

    .score-label {
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 1px;
    }

    .score-count {
      font-family: 'Cormorant Garamond', serif;
      font-size: 24px;
      color: var(--gold);
    }

    .score-count span { font-size: 14px; color: var(--text-dim); }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 24px;
    }

    .square {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(201,168,76,0.12);
      border-radius: 12px;
      padding: 12px 8px;
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: var(--text-dim);
      line-height: 1.5;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      position: relative;
      min-height: 100px;
      gap: 6px;
    }

    .square .sq-emoji {
      font-size: 24px;
      line-height: 1;
    }

    .square .sq-text {
      font-size: 13px;
      line-height: 1.4;
      color: var(--text);
    }

    .square:hover {
      border-color: rgba(201,168,76,0.3);
      background: rgba(201,168,76,0.05);
    }

    .square.checked {
      background: var(--checked);
      border-color: var(--checked-border);
      color: var(--gold-light);
    }

    .square.checked::after {
      content: '‚úì';
      position: absolute;
      top: 3px;
      right: 5px;
      font-size: 8px;
      color: var(--gold);
    }

    .square.animate {
      animation: pop 0.3s ease;
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.12); }
      100% { transform: scale(1); }
    }

    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--gold), #a07828);
      color: #0a0a0f;
      border: none;
      border-radius: 12px;
      font-family: 'Tajawal', sans-serif;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      margin-bottom: 12px;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(201,168,76,0.3);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid rgba(201,168,76,0.3);
      color: var(--text-dim);
      font-size: 14px;
      padding: 12px;
    }

    .btn-outline:hover {
      border-color: rgba(201,168,76,0.5);
      color: var(--gold);
      box-shadow: none;
    }

    /* Result overlay */
    .result-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 24px;
      backdrop-filter: blur(8px);
    }

    .result-overlay.show {
      display: flex;
    }

    .result-card {
      background: linear-gradient(135deg, #0f0f1a, #12121f);
      border: 1px solid rgba(201,168,76,0.3);
      border-radius: 20px;
      padding: 40px 32px;
      text-align: center;
      max-width: 360px;
      width: 100%;
      position: relative;
    }

    .result-card::before {
      content: '';
      position: absolute;
      inset: -1px;
      background: linear-gradient(135deg, rgba(201,168,76,0.3), transparent, rgba(201,168,76,0.1));
      border-radius: 20px;
      z-index: -1;
    }

    .result-moon { font-size: 48px; margin-bottom: 12px; }

    .result-score {
      font-family: 'Cormorant Garamond', serif;
      font-size: 64px;
      color: var(--gold);
      line-height: 1;
      margin-bottom: 4px;
    }

    .result-out-of {
      font-size: 12px;
      color: var(--text-dim);
      letter-spacing: 2px;
      margin-bottom: 20px;
    }

    .result-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      color: var(--cream);
      margin-bottom: 12px;
      line-height: 1.2;
    }

    .result-message {
      font-size: 14px;
      color: var(--text-dim);
      line-height: 1.7;
      margin-bottom: 28px;
      font-weight: 300;
    }

    .result-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .btn-share {
      background: linear-gradient(135deg, var(--gold), #a07828);
      color: #0a0a0f;
      border: none;
      border-radius: 10px;
      padding: 14px;
      font-family: 'Tajawal', sans-serif;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      letter-spacing: 0.5px;
      transition: all 0.3s;
    }

    .btn-share:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(201,168,76,0.3); }

    .btn-dua {
      background: rgba(201,168,76,0.1);
      border: 1px solid rgba(201,168,76,0.25);
      color: var(--gold-light);
      border-radius: 10px;
      padding: 14px;
      font-family: 'Tajawal', sans-serif;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: block;
    }

    .btn-dua:hover { border-color: rgba(201,168,76,0.5); }

    .btn-retry {
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-family: 'Tajawal', sans-serif;
      font-size: 13px;
      cursor: pointer;
      padding: 8px;
      transition: color 0.2s;
    }

    .btn-retry:hover { color: var(--gold); }

    /* Share toast */
    .toast {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(201,168,76,0.9);
      color: #0a0a0f;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 13px;
      font-weight: 500;
      transition: transform 0.3s ease;
      z-index: 200;
    }

    .toast.show { transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>
  <div class="page">
    <a href="index.html" class="back">‚Üê Back to Noor</a>

    <div class="header">
      <div class="header-icon">‚òëÔ∏è</div>
      <h1>Ramadan Real Talk</h1>
      <div id="bingo-greeting" style="font-size:13px; color:var(--gold-dim); font-style:italic; margin-bottom:4px; min-height:18px;"></div>
      <p>Tap every square that applies to you. No judgment here.</p>
    </div>

    <div class="score-bar">
      <span class="score-label">SQUARES CHECKED</span>
      <div class="score-count"><span id="checked-count">0</span> <span>/ 15</span></div>
    </div>

    <div class="grid" id="bingo-grid"></div>

    <button class="btn" onclick="showResult()">See My Result ‚Üí</button>
    <button class="btn btn-outline" onclick="resetGrid()">Start Fresh</button>
  </div>

  <!-- Result Overlay -->
  <div class="result-overlay" id="result-overlay">
    <div class="result-card" id="result-card">
      <div class="result-moon">üåô</div>
      <div class="result-score" id="result-score">0</div>
      <div class="result-out-of">OUT OF 15</div>
      <div class="result-title" id="result-title"></div>
      <div class="result-message" id="result-message"></div>
      <div class="result-actions">
        <button class="btn-share" onclick="shareResult()">üñº Save & Share Card</button>
        <a href="dua.html" class="btn-dua">ü§≤ Get a personal dua for Ramadan</a>
        <button class="btn-retry" onclick="closeResult()">‚Üê Try again</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Copied to clipboard! Share with friends üåô</div>

  <script>
    const ALL_SQUARES = [
      // Sahur Struggles
      "üò¥ Slept through Sahur completely",
      "üçö Ate last night's jollof as Sahur",
      "‚è∞ Set 4 alarms, snoozed all of them",
      "üíß Drank so much water at Sahur your stomach sloshed",
      "üßç Ate standing up, no time to sit",
      "üç™ Sahur was just biscuit and tea",
      "üòµ Woke for Sahur, saw the time, went back to sleep",
      "üç≥ Made a full pot of rice at 3am like you had sense",
      // Fasting Struggles
      "üïê Checked the time every 10 mins after Asr",
      "üò§ Argued while fasting then said Astaghfirullah",
      "üò∞ Accidentally swallowed your saliva and panicked",
      "üëÉ Smelled food and stood there too long",
      "‚úã Said 'I'm fasting' to win an argument",
      "üç≤ Cooked for others and suffered in silence",
      "üîç Googled 'does this break my fast' at least once",
      "ü§§ Thought about Iftar food since Fajr",
      // Spiritual Moments
      "üò¢ Cried during a dua and didn't expect to",
      "üìñ Said you'd finish the Quran this Ramadan",
      "üì± Opened Quran app, ended up on TikTok",
      "üïå Prayed Tarawih then left after 4 rakaat",
      "ü§≤ Made a dua so specific only Allah understood",
      "üò™ Fell asleep in sujood, called it spiritual rest",
      "ü§ù Promised Allah things you're still negotiating",
      "üåô Had a genuine moment of peace at Tahajjud",
      // Iftar Energy
      "üå¥ Broke fast with dates then ate like it's your last meal",
      "üòµ Iftar food coma hit before Maghrib was over",
      "üë®‚Äçüç≥ Cooked a full feast for Iftar alone",
      "üí¶ First sip of water felt like paradise",
      "üò¨ Overate at Iftar then felt guilty at Tarawih",
      "üòÖ Said 'just one more' at Iftar table four times",
      "ü´£ An Iftar spread at someone's house humbled you",
      "‚è±Ô∏è Finished eating and it was only 7pm",
      // Nigerian Flavor
      "üì¢ Your mum woke the whole house with maximum noise",
      "üêü Someone fried fish in the house during your fast",
      "ü•ò Aunty brought food 'just to greet' and you suffered",
      "üòí Your coworker ate in front of you and smiled",
      "üéâ Family Iftar turned into a full owambe somehow",
      "üò© Explained fasting to someone for the 10th time",
      "üçõ Mum's soup made the whole house smell dangerous",
      "üíº Boss scheduled a lunch meeting during Ramadan",
      // Relapse Moments
      "üéµ Listened to music, felt bad, listened again",
      "üò† Got angry then remembered you're fasting",
      "üëÄ Backbited someone then said Astaghfirullah",
      "üì∫ Watched something you shouldn't, closed it, opened it again",
      "üôà Skipped a prayer, told yourself you'd make it up",
      "üí§ Napped so hard you missed Asr",
      "üòÆ Complained about hunger out loud then caught yourself",
      "üê¶ Scrolled Twitter 2 hours instead of reading Quran",
      // End of Ramadan
      "üòî Felt sad Ramadan is ending before it started",
      "‚ú® Last 10 nights hit different this year",
      "üòü Laylatul Qadr anxiety was very real",
      "üåü Made your best duas in the last 10 nights",
      "üò≠ Cried on Eid because Ramadan was over",
      "üí™ Promised yourself next Ramadan will be different",
      "üíõ Felt genuinely changed by this Ramadan",
      "üåÖ Eid morning felt bittersweet",
      // Bonus Chaos
      "üöó Lost your temper in traffic while fasting",
      "üë∂ A child offered you food innocently and it hurt",
      "üçï Dreamed about food during a nap",
      "ü§¶ Said Bismillah then realized it wasn't Iftar yet"
    ];

    const RESULTS = [
      { min: 0,  max: 2,  title: "Masha Allah, are you even human?", message: "Either you're extremely disciplined or you haven't been paying attention. Either way, we respect it. Ramadan Kareem. üåô" },
      { min: 3,  max: 5,  title: "Solid Muslim, few struggles", message: "You're doing well, honestly. A few moments of chaos but mostly holding it together. Allah sees the effort. Keep going." },
      { min: 6,  max: 8,  title: "Ramadan Warrior", message: "Fighting battles on multiple fronts ‚Äî the hunger, the naps, the TikTok temptation. You're still here. That counts for everything." },
      { min: 9,  max: 11, title: "Certified Ramadan Experience Haver", message: "You have LIVED this Ramadan. Every struggle, every moment of weakness, every unexpected tear. This is real. Allah loves the ones who keep trying. ü§ç" },
      { min: 12, max: 13, title: "This Ramadan Has Been a Journey üòÖ", message: "Chaos, grace, guilt, genuine moments ‚Äî you've had it all. The beautiful thing? You're still here, still fasting, still trying. That's what Ramadan is about." },
      { min: 14, max: 15, title: "The Most Honest Muslim in the Room", message: "You ticked almost everything. No pretending. No performing. Just real, honest, human Ramadan. Allah loves honesty more than perfection. Ramadan Mubarak. üíõ" }
    ];

    let selected = new Set();
    let currentSquares = [];

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildGrid() {
      selected.clear();
      currentSquares = shuffle(ALL_SQUARES).slice(0, 15);
      const grid = document.getElementById('bingo-grid');
      grid.innerHTML = '';

      currentSquares.forEach((text, i) => {
        const sq = document.createElement('div');
        sq.className = 'square';

        // Split emoji from text
        const emojiMatch = text.match(/^(\S+)\s(.+)$/);
        if (emojiMatch) {
          const emojiEl = document.createElement('span');
          emojiEl.className = 'sq-emoji';
          emojiEl.textContent = emojiMatch[1];

          const textEl = document.createElement('span');
          textEl.className = 'sq-text';
          textEl.textContent = emojiMatch[2];

          sq.appendChild(emojiEl);
          sq.appendChild(textEl);
        } else {
          sq.textContent = text;
        }

        sq.dataset.index = i;
        sq.addEventListener('click', () => toggleSquare(sq, i));
        grid.appendChild(sq);
      });

      updateCount();
    }

    function toggleSquare(el, i) {
      if (selected.has(i)) {
        selected.delete(i);
        el.classList.remove('checked');
      } else {
        selected.add(i);
        el.classList.add('checked');
        el.classList.add('animate');
        setTimeout(() => el.classList.remove('animate'), 300);
      }
      updateCount();
    }

    function updateCount() {
      document.getElementById('checked-count').textContent = selected.size;
    }

    function showResult() {
      const count = selected.size;
      gtag('event', 'bingo_shared', { event_category: 'engagement', value: count });
      const result = RESULTS.find(r => count >= r.min && count <= r.max) || RESULTS[RESULTS.length - 1];

      document.getElementById('result-score').textContent = count;
      document.getElementById('result-title').textContent = result.title;
      document.getElementById('result-message').textContent = result.message;
      document.getElementById('result-overlay').classList.add('show');
    }

    function closeResult() {
      document.getElementById('result-overlay').classList.remove('show');
    }

    function resetGrid() {
      buildGrid();
    }

    async function shareResult() {
      const count = selected.size;
      const result = RESULTS.find(r => count >= r.min && count <= r.max) || RESULTS[RESULTS.length - 1];
      const checkedItems = [...selected].map(i => currentSquares[i]);
      const canvas = generateBingoCard(count, result, checkedItems);
      await shareCanvas(canvas, 'noor-bingo.png');
    }

    function generateBingoCard(count, result, checkedItems) {
      const W = 1080, H = 1350;
      const canvas = document.createElement('canvas');
      canvas.width = W; canvas.height = H;
      const ctx = canvas.getContext('2d');

      ctx.fillStyle = '#0a0a0f';
      ctx.fillRect(0, 0, W, H);

      // Top glow
      const g = ctx.createRadialGradient(W/2, 0, 0, W/2, 0, 500);
      g.addColorStop(0, 'rgba(201,168,76,0.1)'); g.addColorStop(1, 'transparent');
      ctx.fillStyle = g; ctx.fillRect(0, 0, W, H);

      // Border
      ctx.strokeStyle = 'rgba(201,168,76,0.2)'; ctx.lineWidth = 2;
      roundRect(ctx, 60, 60, W-120, H-120, 32); ctx.stroke();

      // Header
      ctx.fillStyle = '#7a6130'; ctx.font = '600 28px sans-serif'; ctx.textAlign = 'center';
      ctx.fillText('‚ú¶  N O O R  ‚ú¶', W/2, 140);
      ctx.strokeStyle = 'rgba(201,168,76,0.15)'; ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(160, 165); ctx.lineTo(W-160, 165); ctx.stroke();

      // Title
      ctx.fillStyle = '#e8c97a'; ctx.font = '700 52px serif';
      ctx.fillText('Ramadan Real Talk', W/2, 240);
      ctx.fillStyle = '#c9a84c'; ctx.font = '400 32px serif';
      ctx.fillText('Bingo üåô', W/2, 290);

      // Score
      ctx.fillStyle = '#e8c97a'; ctx.font = '700 110px serif';
      ctx.fillText(`${count}/15`, W/2, 420);

      // Result title
      ctx.fillStyle = '#c9a84c'; ctx.font = 'italic 38px serif';
      const titleLines = wrapText(ctx, `"${result.title}"`, W - 160);
      let ty = 480;
      titleLines.forEach(l => { ctx.fillText(l, W/2, ty); ty += 52; });

      // Divider
      ty += 10;
      ctx.strokeStyle = 'rgba(201,168,76,0.15)'; ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(160, ty); ctx.lineTo(W-160, ty); ctx.stroke();
      ty += 40;

      // Checked items label
      ctx.fillStyle = '#7a6130'; ctx.font = '500 22px sans-serif';
      ctx.fillText('WHAT I TICKED', W/2, ty); ty += 44;

      // Checked items list
      ctx.textAlign = 'left';
      const colW = (W - 200) / 2;
      checkedItems.forEach((item, i) => {
        const col = i % 2;
        const row = Math.floor(i / 2);
        const x = 120 + col * (colW + 40);
        const y = ty + row * 52;
        // Item bg pill
        ctx.fillStyle = 'rgba(201,168,76,0.08)';
        roundRect(ctx, x - 10, y - 28, colW, 42, 10);
        ctx.fill();
        // Text
        ctx.fillStyle = '#e8dcc8'; ctx.font = '24px sans-serif';
        const short = item.length > 28 ? item.slice(0, 27) + '‚Ä¶' : item;
        ctx.fillText(short, x + 8, y);
      });

      const rows = Math.ceil(checkedItems.length / 2);
      ty += rows * 52 + 20;

      // Footer
      ctx.textAlign = 'center';
      ctx.strokeStyle = 'rgba(201,168,76,0.15)'; ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(160, H-175); ctx.lineTo(W-160, H-175); ctx.stroke();
      ctx.fillStyle = '#7a6130'; ctx.font = '24px serif';
      ctx.fillText('What\'s your Ramadan Real Talk score?', W/2, H-130);
      ctx.fillStyle = '#5a4820'; ctx.font = '22px sans-serif';
      ctx.fillText('noor-seven-lac.vercel.app', W/2, H-88);

      return canvas;
    }

    // ‚îÄ‚îÄ Canvas helpers (shared) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function wrapText(ctx, text, maxWidth) {
      const words = text.split(' ');
      const lines = [];
      let line = '';
      words.forEach(word => {
        const test = line ? line + ' ' + word : word;
        if (ctx.measureText(test).width > maxWidth && line) { lines.push(line); line = word; }
        else { line = test; }
      });
      if (line) lines.push(line);
      return lines;
    }

    function roundRect(ctx, x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.lineTo(x+w-r, y); ctx.arcTo(x+w, y, x+w, y+r, r);
      ctx.lineTo(x+w, y+h-r); ctx.arcTo(x+w, y+h, x+w-r, y+h, r);
      ctx.lineTo(x+r, y+h); ctx.arcTo(x, y+h, x, y+h-r, r);
      ctx.lineTo(x, y+r); ctx.arcTo(x, y, x+r, y, r);
      ctx.closePath();
    }

    async function shareCanvas(canvas, filename) {
      return new Promise(resolve => {
        canvas.toBlob(async blob => {
          const file = new File([blob], filename, { type: 'image/png' });
          try {
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
              await navigator.share({ files: [file], title: 'Noor ¬∑ Ramadan 1447H', url: 'https://noor-seven-lac.vercel.app' });
            } else {
              const a = document.createElement('a');
              a.href = URL.createObjectURL(blob); a.download = filename; a.click();
            }
          } catch {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob); a.download = filename; a.click();
          }
          resolve();
        }, 'image/png');
      });
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      if (msg) toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Init
    buildGrid();

    // Name greeting
    const _bingoName = localStorage.getItem('noor_name');
    if (_bingoName) {
      const el = document.getElementById('bingo-greeting');
      if (el) el.textContent = `Be honest, ${_bingoName} üòÑ`;
    }
  </script>

  <script>
    // ‚îÄ‚îÄ Service Worker Registration ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('Noor SW registered'))
          .catch(err => console.log('SW error:', err));
      });
    }

    // ‚îÄ‚îÄ iOS Install Banner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function isIos() {
      return /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
    }
    function isInStandaloneMode() {
      return ('standalone' in navigator) && navigator.standalone;
    }
    function showIosBanner() {
      if (isIos() && !isInStandaloneMode() && !localStorage.getItem('noor_ios_banner_dismissed')) {
        const banner = document.createElement('div');
        banner.id = 'ios-install-banner';
        banner.innerHTML = `
          <div style="position:fixed;bottom:0;left:0;right:0;z-index:9999;background:#1a1408;border-top:1px solid rgba(201,168,76,0.3);padding:16px 20px;display:flex;align-items:center;gap:14px;font-family:'Tajawal',sans-serif;">
            <img src="/icons/apple-touch-icon.png" style="width:48px;height:48px;border-radius:12px;flex-shrink:0;">
            <div style="flex:1;">
              <div style="color:#e8c97a;font-size:14px;font-weight:600;margin-bottom:2px;">Add Noor to Home Screen</div>
              <div style="color:#8a7d6a;font-size:12px;line-height:1.4;">Tap <strong style="color:#c9a84c;">Share</strong> then <strong style="color:#c9a84c;">"Add to Home Screen"</strong> for the best experience üåô</div>
            </div>
            <button onclick="document.getElementById('ios-install-banner').remove(); localStorage.setItem('noor_ios_banner_dismissed','1')" style="background:none;border:none;color:#7a6130;font-size:22px;cursor:pointer;padding:4px;flex-shrink:0;">‚úï</button>
          </div>`;
        document.body.appendChild(banner);
      }
    }
    window.addEventListener('load', showIosBanner);

    // ‚îÄ‚îÄ Android Install Prompt ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      if (!localStorage.getItem('noor_android_installed')) {
        const banner = document.createElement('div');
        banner.id = 'android-install-banner';
        banner.innerHTML = `
          <div style="position:fixed;bottom:0;left:0;right:0;z-index:9999;background:#1a1408;border-top:1px solid rgba(201,168,76,0.3);padding:16px 20px;display:flex;align-items:center;gap:14px;font-family:'Tajawal',sans-serif;">
            <img src="/icons/apple-touch-icon.png" style="width:48px;height:48px;border-radius:12px;flex-shrink:0;">
            <div style="flex:1;">
              <div style="color:#e8c97a;font-size:14px;font-weight:600;margin-bottom:2px;">Install Noor</div>
              <div style="color:#8a7d6a;font-size:12px;">Add to your home screen for quick access üåô</div>
            </div>
            <button onclick="installApp()" style="background:linear-gradient(135deg,#c9a84c,#a07828);border:none;border-radius:10px;color:#0a0a0f;font-size:13px;font-weight:700;padding:10px 16px;cursor:pointer;flex-shrink:0;font-family:'Tajawal',sans-serif;">Install</button>
            <button onclick="document.getElementById('android-install-banner').remove()" style="background:none;border:none;color:#7a6130;font-size:22px;cursor:pointer;padding:4px;flex-shrink:0;">‚úï</button>
          </div>`;
        document.body.appendChild(banner);
      }
    });

    async function installApp() {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        localStorage.setItem('noor_android_installed', '1');
        document.getElementById('android-install-banner')?.remove();
      }
      deferredPrompt = null;
    }
  </script>
</body>
</html>
